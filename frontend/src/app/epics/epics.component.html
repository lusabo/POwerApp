<div class="card">
  <h2>{{ 'epics.title' | translate }}</h2>

  <form [formGroup]="form" (ngSubmit)="associateEpic()" class="row">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'epics.epicKey' | translate }}</mat-label>
      <input matInput formControlName="epicKey" />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>{{ 'epics.domainCycle' | translate }}</mat-label>
      <mat-select formControlName="domainCycleId">
        <mat-option [value]="''">{{ 'epics.none' | translate }}</mat-option>
        @for (dc of domainCycles(); track dc.id) {
          <mat-option [value]="dc.id">{{ dc.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <button mat-raised-button color="primary" type="submit" [disabled]="loading()">
      {{ loading() ? ('epics.saving' | translate) : ('epics.associate' | translate) }}
    </button>
    <button mat-stroked-button type="button" (click)="reload()" [disabled]="loading()">
      {{ 'epics.reload' | translate }}
    </button>
  </form>

  <form [formGroup]="filterForm" (ngSubmit)="loadEpics()" class="row">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'epics.filterByDomainCycle' | translate }}</mat-label>
      <mat-select formControlName="domainCycleId" (selectionChange)="loadEpics()">
        <mat-option [value]="''">{{ 'epics.all' | translate }}</mat-option>
        @for (dc of domainCycles(); track dc.id) {
          <mat-option [value]="dc.id">{{ dc.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </form>

  @if (loading()) {
    <div class="overlay" aria-live="polite">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }

  <table class="data-table" role="table">
    <thead>
      <tr>
        <th scope="col">{{ 'epics.table.epicKey' | translate }}</th>
        <th scope="col">{{ 'epics.table.name' | translate }}</th>
        <th scope="col">{{ 'epics.table.domainCycle' | translate }}</th>
        <th scope="col">{{ 'epics.table.effort' | translate }}</th>
        <th scope="col">{{ 'epics.table.issues' | translate }}</th>
        <th scope="col">{{ 'epics.table.sp' | translate }}</th>
      </tr>
    </thead>
    <tbody>
      @for (e of epics(); track e.id) {
        <tr>
          <td>{{ e.epicKey }}</td>
          <td>{{ e.name }}</td>
          <td>{{ e.domainCycleName || '-' }}</td>
          <td>{{ e.effortSize || '-' }}</td>
          <td>{{ e.issuesCount }}</td>
          <td>{{ e.storyPointsSum }}</td>
        </tr>
      } @empty {
        <tr>
          <td colspan="6">Nenhuma Ã©pica cadastrada.</td>
        </tr>
      }
    </tbody>
  </table>
</div>
