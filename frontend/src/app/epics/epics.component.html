<div class="card">
  <h2>Gerenciar Épicos</h2>

  <form [formGroup]="form" (ngSubmit)="associateEpic()" class="row">
    <mat-form-field appearance="outline">
      <mat-label>Epic key (ex: PROJ-1)</mat-label>
      <input matInput formControlName="epicKey" />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Domain Cycle</mat-label>
      <mat-select formControlName="domainCycleId">
        <mat-option [value]="''">Nenhum</mat-option>
        <mat-option *ngFor="let dc of domainCycles" [value]="dc.id">{{ dc.name }}</mat-option>
      </mat-select>
    </mat-form-field>
    <button mat-raised-button color="primary" type="submit" [disabled]="loading">
      {{ loading ? 'Salvando...' : 'Associar Épico' }}
    </button>
    <button mat-stroked-button type="button" (click)="reload()" [disabled]="loading">Reload</button>
  </form>

  <form [formGroup]="filterForm" (ngSubmit)="loadEpics()" class="row">
    <mat-form-field appearance="outline">
      <mat-label>Filtrar por Domain Cycle</mat-label>
      <mat-select formControlName="domainCycleId" (selectionChange)="loadEpics()">
        <mat-option [value]="''">Todos</mat-option>
        <mat-option *ngFor="let dc of domainCycles" [value]="dc.id">{{ dc.name }}</mat-option>
      </mat-select>
    </mat-form-field>
  </form>

  <div class="overlay" *ngIf="loading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <table mat-table [dataSource]="epics" class="mat-elevation-z1 full">
    <ng-container matColumnDef="epicKey">
      <th mat-header-cell *matHeaderCellDef>Epic Key</th>
      <td mat-cell *matCellDef="let e">{{ e.epicKey }}</td>
    </ng-container>
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Nome</th>
      <td mat-cell *matCellDef="let e">{{ e.name }}</td>
    </ng-container>
    <ng-container matColumnDef="domainCycle">
      <th mat-header-cell *matHeaderCellDef>Domain Cycle</th>
      <td mat-cell *matCellDef="let e">{{ e.domainCycleName || '-' }}</td>
    </ng-container>
    <ng-container matColumnDef="effort">
      <th mat-header-cell *matHeaderCellDef>Effort Size</th>
      <td mat-cell *matCellDef="let e">{{ e.effortSize || '-' }}</td>
    </ng-container>
    <ng-container matColumnDef="issues">
      <th mat-header-cell *matHeaderCellDef>Issues</th>
      <td mat-cell *matCellDef="let e">{{ e.issuesCount }}</td>
    </ng-container>
    <ng-container matColumnDef="sp">
      <th mat-header-cell *matHeaderCellDef>Story Points</th>
      <td mat-cell *matCellDef="let e">{{ e.storyPointsSum }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['epicKey', 'name', 'domainCycle', 'effort', 'issues', 'sp']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['epicKey', 'name', 'domainCycle', 'effort', 'issues', 'sp'];"></tr>
  </table>
</div>
